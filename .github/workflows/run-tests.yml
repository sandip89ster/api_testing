name: Execute API tests workflow
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  Run-API-Tests:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ðŸŽ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ðŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ðŸ”Ž The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v5
      - run: echo "ðŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      - name: setup python
        uses: actions/setup-python@v5
      - name: create .env file
        run: |
          echo "WEBHOOK_TOKEN=${{ secrets.WEBHOOK_TOKEN }}" > .env
          echo "X_API_KEY=${{ secrets.X_API_KEY }}" >> .env
      - name: Install libraries
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest -q --alluredir=allure-results
      - name: Generate Allure test report
        uses: andgineer/allure-report@v3.6
        id: allure-report
        if: always()
        with:
          allure-results: allure-results
          website: gh-pages-dir
          reports-site-path: builds/tests
      - name: Deploy Allure report to GitHub Pages
        if: success()
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages
          publish_dir: allure-report
